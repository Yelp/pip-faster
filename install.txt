#!/bin/bash
#######################################################################
# This is the installation script for venv-update.
# To run it:
#   curl http://yelp.github.io/venv-update/install.txt | bash
#
# Or, to get a specific version:
#   curl http://yelp.github.io/venv-update/install.txt | bash -s v1.0.0
#
# Documentation:
#   https://venv-update.rtfd.org
#######################################################################
set -Eeu
trap 'echo "[31mFAILED[m (code $?)"' ERR
version=${1:-v1.1.2}

colorize() {
    echo "[01;36m>[m [01;33m$@[m" >&2
    "$@"
}
canhas(){
    command -v "$1" >/dev/null
}
download() {
    if canhas curl; then
        # --fail: stop if we get 404. wget already does this.
        colorize curl --fail "$1" --output "$2"
    elif canhas wget; then
        colorize wget "$1" --output-document "$2"
    else
        echo "Could not find 'curl', nor 'wget'."
        exit 1
    fi
}

colorize mkdir -p ./bin
download https://raw.githubusercontent.com/Yelp/venv-update/$version/venv_update.py ./bin/venv-update
colorize chmod 755 bin/venv-update

echo '
I have just installed `venv-update` to your bin/ directory.
You should commit it to your source control.

To install python requirements from ./requirements.txt to ./venv/,
simply run: 

    ./bin/venv-update

Please see the user documentation at:
    http://venv-update.rtfd.org/en/stable/
'
